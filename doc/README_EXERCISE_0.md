# Exercise 0: Simple Agentic Assistant Implementation Report

## Overview

This document details the implementation of "Exercise 0," a foundational AI agent designed to answer queries about hotel services, pricing, and availability. Unlike more complex Retrieval-Augmented Generation (RAG) systems, this implementation relies on **direct context injection**, where the relevant dataset is loaded directly into the Large Language Model's (LLM) context window.

The agent is integrated into a FastAPI application, serving real-time responses via WebSockets.

## System Architecture

### 1. FastAPI & WebSocket Integration
The agent is hosted within the `ai_agents_hospitality-api` service. The integration point is defined in `main.py`:

*   **Endpoint**: The agent communicates via the `/ws/{uuid}` WebSocket endpoint.
*   **Async Wrapper**: Since the LangChain invocation is synchronous, the agent logic is wrapped in `handle_hotel_query_simple`. This function uses `asyncio.get_event_loop().run_in_executor` to run the blocking LLM call in a separate thread, ensuring the FastAPI event loop remains responsive.
*   **Fallback Mechanism**: The system checks if the agent and data are available (`EXERCISE_0_AVAILABLE`). If the agent fails to load (e.g., missing data), the system gracefully falls back to hardcoded responses.

### 2. Data Management Strategy
The agent relies on synthetic data generated by the `bookings-db` component. The `load_hotel_data()` function in `hotel_simple_agent.py` implements a robust loading strategy configurable via the `use_local` parameter:

1.  **Configuration Check**: The system checks the `use_local` variable.
    *   If `True` (default): It prioritizes the local path (`ai_agents_hospitality-api/data/hotels`).
    *   If `False`: It prioritizes the external path (`bookings-db/output_files/hotels`).
2.  **Fallback**: If the prioritized path is missing data, it attempts to load from the alternative path.

This flexibility supports both Docker deployments (local mounts) and local development (direct access to generator outputs).

The data consists of:
*   **`hotels.json`**: Structured data containing names, locations, and IDs.
*   **`hotel_details.md`**: Unstructured markdown text describing rooms, amenities, and policies.

These files are combined into a single string and injected into the system prompt.

## Agent Design (`hotel_simple_agent.py`)

The core logic resides in `agents/hotel_simple_agent.py`.

### Key Components

*   **`_create_agent_chain()`**: 
    *   Initializes the LLM connection. It is configured to use **Google Gemini** (`ChatGoogleGenerativeAI`) by default, utilizing the `gemini-1.5-flash` model for speed and efficiency.
    *   Constructs a LangChain `ChatPromptTemplate`.

*   **Prompt Engineering**:
    *   The system prompt is designed to act as a "helpful hotel assistant."
    *   It explicitly receives the `{hotel_context}` variable, which contains the full text of the loaded data.
    *   Instructions emphasize accuracy, specific referencing of hotel names, and formatting responses with markdown (bullet points, tables).

*   **`answer_hotel_question(question)`**:
    *   The main entry point for processing a query.
    *   It ensures data is loaded/cached.
    *   It invokes the LangChain chain with the user's question and the hotel context.

## Capabilities

By having the full context available, the agent can perform complex reasoning tasks such as:
*   **Information Retrieval**: "Where is the Grand Victoria located?"
*   **Pricing Analysis**: "How much is a triple room in peak season?"
*   **Comparison**: "Compare the breakfast prices between hotels in Nice."
*   **Summarization**: "Tell me about the room types available in Paris."

## Tests

The following tests verify the agent's ability to retrieve locations, addresses, meal plans, and summarize room details.

```text
üß™ Testing Exercise 0: Simple Agentic Assistant

============================================================

üìù Test 1/4: List all hotels and their locations
------------------------------------------------------------
2025-12-16 16:26:02,003 - hospitality_api - INFO - Loaded configuration from /home/bdacosta/agentic_ai_PoC_prj_hospitality/ai_agents_hospitality-api/config/agent_config.yaml
2025-12-16 16:26:02,003 - hospitality_api - INFO - Using external hotel data path: /home/bdacosta/agentic_ai_PoC_prj_hospitality/bookings-db/output_files/hotels
2025-12-16 16:26:02,003 - hospitality_api - INFO - Loading hotel data from /home/bdacosta/agentic_ai_PoC_prj_hospitality/bookings-db/output_files/hotels/hotels.json
2025-12-16 16:26:02,004 - hospitality_api - INFO - Loading hotel details from /home/bdacosta/agentic_ai_PoC_prj_hospitality/bookings-db/output_files/hotels/hotel_details.md
2025-12-16 16:26:02,004 - hospitality_api - INFO - Successfully loaded hotel data (0 hotels)
2025-12-16 16:26:02,006 - hospitality_api - INFO - Loaded configuration from /home/bdacosta/agentic_ai_PoC_prj_hospitality/ai_agents_hospitality-api/config/agent_config.yaml
2025-12-16 16:26:02,006 - hospitality_api - INFO - Agent configuration loaded: provider=gemini, model=gemini-2.5-flash-lite, temperature=0
2025-12-16 16:26:02,095 - hospitality_api - INFO - Using Gemini API with model: gemini-2.5-flash-lite
2025-12-16 16:26:02,095 - hospitality_api - INFO - Processing question: List all hotels and their locations...
‚úÖ Response received (238 characters)

Here are the hotels and their locations:

*   **Obsidian Tower** - Cannes, France
*   **Royal Sovereign** - Paris, France
*   **Grand Victoria** - Nice, France
*   **Imperial Crown** - Paris, France
*...

üìù Test 2/4: What is the address of the first hotel?
------------------------------------------------------------
2025-12-16 16:26:03,458 - hospitality_api - INFO - Processing question: What is the address of the first hotel?...
‚úÖ Response received (130 characters)

The first hotel in the provided data is the **Obsidian Tower**.

Its address is: **43321 Brittany Bypass, Cannes, France, 84311**....

üìù Test 3/4: What meal plans are available?
------------------------------------------------------------
2025-12-16 16:26:04,484 - hospitality_api - INFO - Processing question: What meal plans are available?...
‚úÖ Response received (125 characters)

The following meal plans are available:

*   Room Only
*   Room and Breakfast
*   All Inclusive
*   Half Board
*   Full Board...

üìù Test 4/4: Tell me about the rooms in these hotels
------------------------------------------------------------
2025-12-16 16:26:05,428 - hospitality_api - INFO - Processing question: Tell me about the rooms in these hotels...
‚úÖ Response received (30268 characters)

Here's a summary of the rooms available in each hotel:

## Obsidian Tower (Hotel Key: 1825)
*   **Location:** Cannes, France
*   **Address:** 43321 Brittany Bypass, 84311

| Room ID | Floor | Category...

============================================================

üìä Results: 4/4 tests passed
```

### WebSocket Integration Test

The `test_websocket_integration.py` script verifies the end-to-end functionality by connecting to the FastAPI WebSocket endpoint, sending a query, and validating the JSON-wrapped response.

```text
bdacosta@c11-trx74vyigl9:~/agentic_ai_PoC_prj_hospitality/ai_agents_hospitality-api$ /home/bdacosta/agentic_ai_PoC_prj_hospitality/venv/bin/python3 test_websocket_integration.py
2025-12-16 16:51:01,713 - hospitality_api - INFO - Loaded configuration from /home/bdacosta/agentic_ai_PoC_prj_hospitality/ai_agents_hospitality-api/config/agent_config.yaml
2025-12-16 16:51:01,713 - hospitality_api - INFO - Using external hotel data path: /home/bdacosta/agentic_ai_PoC_prj_hospitality/bookings-db/output_files/hotels
2025-12-16 16:51:01,713 - hospitality_api - INFO - Loading hotel data from /home/bdacosta/agentic_ai_PoC_prj_hospitality/bookings-db/output_files/hotels/hotels.json
2025-12-16 16:51:01,714 - hospitality_api - INFO - Loading hotel details from /home/bdacosta/agentic_ai_PoC_prj_hospitality/bookings-db/output_files/hotels/hotel_details.md
2025-12-16 16:51:01,714 - hospitality_api - INFO - Successfully loaded hotel data (0 hotels)
2025-12-16 16:51:01,714 - hospitality_api - INFO - ‚úÖ Exercise 0 agent loaded successfully and hotel data verified
üöÄ Starting WebSocket Integration Test
======================================
üì° Connecting to WebSocket at /ws/test-uuid-123...
2025-12-16 16:51:01,725 - hospitality_api - INFO - WebSocket connection opened for test-uuid-123
üì§ Sending message: list the hotels in france
2025-12-16 16:51:01,726 - hospitality_api - INFO - Received from test-uuid-123: list the hotels in france
‚è≥ Waiting for response...
2025-12-16 16:51:01,726 - hospitality_api - INFO - Using Exercise 0 agent for query: list the hotels in france...
2025-12-16 16:51:01,729 - hospitality_api - INFO - Loaded configuration from /home/bdacosta/agentic_ai_PoC_prj_hospitality/ai_agents_hospitality-api/config/agent_config.yaml
2025-12-16 16:51:01,730 - hospitality_api - INFO - Agent configuration loaded: provider=gemini, model=gemini-2.5-flash-lite, temperature=0
2025-12-16 16:51:01,818 - hospitality_api - INFO - Using Gemini API with model: gemini-2.5-flash-lite
2025-12-16 16:51:01,818 - hospitality_api - INFO - Processing question: list the hotels in france...
2025-12-16 16:51:03,109 - hospitality_api - INFO - ‚úÖ Exercise 0 agent response generated successfully for test-uuid-123
2025-12-16 16:51:03,109 - hospitality_api - INFO - Sent response to test-uuid-123
üì• Received raw response: JSONSTART{"role": "assistant", "content": "Here are the hotels located in France:\n\n*   **Obsidian ...

üìã Parsed Response Content:
----------------------------------------
Here are the hotels located in France:

*   **Obsidian Tower** in Cannes
*   **Royal Sovereign** in Paris
*   **Grand Victoria** in Nice
*   **Imperial Crown** in Paris
*   **Majestic Plaza** in Cannes
----------------------------------------

‚úÖ WebSocket integration test PASSED!
```
